<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CII Performance & Strategy Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-white font-sans p-4 md:p-8">

    <div class="max-w-4xl mx-auto border border-slate-200 rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-slate-900 p-8 text-white">
            <h1 class="text-2xl font-bold tracking-tight uppercase">CII <span class="text-blue-400">Calculator</span></h1>
            <p class="text-slate-400 text-sm mt-1">Operational Efficiency & Strategy Simulator</p>
        </div>

        <div class="p-8 grid md:grid-cols-2 gap-10 bg-slate-50">
            <div class="space-y-4">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Inputs</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-xs font-bold mb-1">Fuel Type</label>
                        <select id="fuelType" onchange="calculate()" class="w-full p-3 rounded-xl border-none shadow-sm ring-1 ring-slate-200">
                            <option value="3.206">MDO / MGO (3.206)</option>
                            <option value="3.114">HFO (3.114)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold mb-1">DWT Capacity</label>
                        <input type="number" id="capacity" value="50000" oninput="calculate()" class="w-full p-3 rounded-xl border-none shadow-sm ring-1 ring-slate-200">
                    </div>
                    <div>
                        <label class="block text-xs font-bold mb-1">Fuel (mt)</label>
                        <input type="number" id="fuel" value="1000" oninput="calculate()" class="w-full p-3 rounded-xl border-none shadow-sm ring-1 ring-slate-200 text-blue-600 font-bold">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-xs font-bold mb-1">Distance (nm)</label>
                        <input type="number" id="distance" value="20000" oninput="calculate()" class="w-full p-3 rounded-xl border-none shadow-sm ring-1 ring-slate-200 text-green-600 font-bold">
                    </div>
                </div>
            </div>

            <div class="flex flex-col justify-center items-center bg-white rounded-2xl p-6 border border-slate-200 shadow-sm">
                <p class="text-[10px] font-black uppercase text-slate-400">Current 2026 Rating</p>
                <div id="ratingBox" class="text-8xl font-black my-2">C</div>
                <p id="ciiVal" class="text-lg font-mono text-slate-500">0.00</p>
            </div>
        </div>

        <div class="p-8 border-t border-slate-100">
            <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6 text-center">Efficiency Strategy: How to reach Grade A</h2>
            <div class="h-64">
                <canvas id="strategyChart"></canvas>
            </div>
            <div class="mt-8 grid grid-cols-3 gap-4 text-center">
                <div class="p-4 bg-blue-50 rounded-xl">
                    <p class="text-[10px] font-bold text-blue-400 uppercase">Slow Steaming</p>
                    <p class="text-xs text-blue-900 mt-1">Reduce fuel by 10% to improve rating.</p>
                </div>
                <div class="p-4 bg-green-50 rounded-xl">
                    <p class="text-[10px] font-bold text-green-400 uppercase">Ballast Leg</p>
                    <p class="text-xs text-green-900 mt-1">Increase distance to lower intensity.</p>
                </div>
                <div class="p-4 bg-amber-50 rounded-xl">
                    <p class="text-[10px] font-bold text-amber-400 uppercase">2030 Risk</p>
                    <p class="text-xs text-amber-900 mt-1">Stricter limits make this ship a 'D'.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let myChart;

        function calculate() {
            const cap = parseFloat(document.getElementById('capacity').value);
            const fuel = parseFloat(document.getElementById('fuel').value);
            const dist = parseFloat(document.getElementById('distance').value);
            const cf = parseFloat(document.getElementById('fuelType').value);

            const attained = (fuel * cf * 1000000) / (cap * dist);
            const ref = 4745 * Math.pow(cap, -0.622); // Required C-line

            // Boundaries
            const a = ref * 0.83;
            const b = ref * 0.94;
            const c = ref * 1.06;
            const d = ref * 1.28;

            let rating = 'E';
            let color = '#ef4444';
            if (attained <= a) { rating = 'A'; color = '#22c55e'; }
            else if (attained <= b) { rating = 'B'; color = '#84cc16'; }
            else if (attained <= c) { rating = 'C'; color = '#eab308'; }
            else if (attained <= d) { rating = 'D'; color = '#f97316'; }

            document.getElementById('ratingBox').innerText = rating;
            document.getElementById('ratingBox').style.color = color;
            document.getElementById('ciiVal').innerText = `Attained: ${attained.toFixed(2)}`;

            updateChart(attained, a, b, c);
        }

        function updateChart(current, a, b, c) {
            const ctx = document.getElementById('strategyChart').getContext('2d');
            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Current', '-10% Fuel', '+10% Distance', '2030 Limit'],
                    datasets: [{
                        label: 'CII Value',
                        data: [current, current * 0.9, current * 0.91, current], 
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointBackgroundColor: '#2563eb'
                    }, {
                        label: 'Grade A Target',
                        data: [a, a, a, a * 0.85], // 2030 is stricter
                        borderColor: '#22c55e',
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: false, title: { display: true, text: 'Intensity' } } }
                }
            });
        }

        calculate();
    </script>
</body>
</html>
